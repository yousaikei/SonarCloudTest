# Cloud Build 配置文件
steps:
  # 步骤 1: 运行 Python HelloWorld
  - name: 'python:3.9-slim'
    entrypoint: 'python'
    args: ['main.py']
    id: 'run-hello-world'

  # 步骤 2: SonarCloud 扫描
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'run'
      - '--rm'
      - '-v'
      - '/workspace:/usr/src'
      - '-w'
      - '/usr/src'
      - '-e'
      - 'SONAR_TOKEN=$_SONARTOKEN'
      - 'sonarsource/sonar-scanner-cli:latest'
      - 'sonar-scanner'
      - '-Dsonar.projectKey=SonarCloudTest'
      - '-Dsonar.organization=yousaikei'
      - '-Dsonar.host.url=https://sonarcloud.io'
      - '-Dsonar.login=$_SONARTOKEN'
      - '-Dsonar.sources=.'
    id: 'sonar-scan'
    dependsOn: ['run-hello-world']

# 可选: 设置超时
timeout: '600s'

